function [bciStruct] = bciCsv2struct(csv_filename)
%This Function aims to decomposed a given BCI csv file
%into structure of trials
%input : csv_file_path

csvMatrix = csvread(csv_filename,1,0);
screeningEEG = csvMatrix(:,1:32);
mentalTaskId = csvMatrix(:,33);
trialNumber = csvMatrix(:,34);
runId = csvMatrix(:,35);
phaseId = unique(csvMatrix(:,36));
runIdClasses = unique(runId);%get distinct run numbers
trialIdClasses = unique(trialNumber);%get distinct trial Id
mentalTaskIds = uint8(unique(mentalTaskId));%get distinct mental ids
% EEG Session
runN = length(runIdClasses);%number of runs in a session
for j=1:runN
  runIndices = find((runId==runIdClasses(j)));%% indices of Run(j)
  runTrialNumbers = unique(trialNumber(runIndices,:));%% trials number in run
  trialN = length(runTrialNumbers);%%number of trials in the run
for i=1:trialN
  % Describe EEG Structure
  trialIndices = find(trialNumber == runTrialNumbers(i));
eeg = struct...
('fp1',screeningEEG(trialIndices,1),...
'fp2',screeningEEG(trialIndices,2),...
'af3',screeningEEG(trialIndices,3),...
'af4',screeningEEG(trialIndices,4),...
'f7',screeningEEG(trialIndices,5),...
'f3',screeningEEG(trialIndices,6),...
'fz',screeningEEG(trialIndices,7),...
'f4',screeningEEG(trialIndices,8),...
'f8',screeningEEG(trialIndices,9),...
'fc5',screeningEEG(trialIndices,10),...
'fc1',screeningEEG(trialIndices,11),...
'fc2',screeningEEG(trialIndices,12),...
'fc6',screeningEEG(trialIndices,13),...
't7',screeningEEG(trialIndices,14),...
'c3',screeningEEG(trialIndices,15),...
'cz',screeningEEG(trialIndices,16),...
'c4',screeningEEG(trialIndices,17),...
't8',screeningEEG(trialIndices,18),...
'cp5',screeningEEG(trialIndices,19),...
'cp1',screeningEEG(trialIndices,20),...
'cp2',screeningEEG(trialIndices,21),...
'cp6',screeningEEG(trialIndices,22),...
'p7',screeningEEG(trialIndices,23),...
'p3',screeningEEG(trialIndices,24),...
'pz',screeningEEG(trialIndices,25),...
'p4',screeningEEG(trialIndices,26),...
'p8',screeningEEG(trialIndices,27),...
'po7',screeningEEG(trialIndices,28),...
'po3',screeningEEG(trialIndices,29),...
'po4',screeningEEG(trialIndices,30),...
'po8',screeningEEG(trialIndices,31),...
'oz',screeningEEG(trialIndices,32)...
);
taskId = unique(mentalTaskId(trialIndices));
 
if phaseId == 1
    if taskId == 1
     description = 'left hand';
    elseif taskId == 2
     description ='right hand';
    elseif taskId == 3
     description ='left foot'; 
    elseif taskId == 4
     description ='right foot';
     elseif taskId == 5
     description ='rest';
    else
     description='unknown mental task';
    end
     phase = 'screening phase';
elseif phaseId >= 2 && phaseId <= 4
     description = 'target_number';
     if phaseId == 2
         phase = 'vertical 1d control';
     elseif phaseId == 3
         phase = 'horizontal 1d control';
     elseif phaseId == 4
         phase = '2d control';
     end
else
     description = 'unknown';
     phase = 'unknown';
end         
 
trials(i) = struct('eeg',eeg,'taskId',taskId,'taskIdDescription',description);
end
runs(j) = struct('trials',trials);
end

%for i=1:length(mentalTaskIds)
 %   taskIdsDescription
%end
session = struct('phase',phase,'TrialsCount',length(trialIdClasses),...
'taskIds',mentalTaskIds,'RunsCount',runN,'sampling_freq',250,'runs',runs);

bciStruct = session;
end

